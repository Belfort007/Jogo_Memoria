<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Mem√≥ria - Edi√ß√£o Extrema</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #e0f7fa;
            --card-back-color: #26c6da;
            --card-bg-front: #ffffff;
            --text-color: #006064;
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .header-painel {
            background: white;
            padding: 10px 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }

        .stat-box {
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color);
        }

        /* Badge de dificuldade no painel */
        .badge-difficulty {
            font-size: 0.7rem;
            background: #e0f2f1;
            color: #00897b;
            padding: 4px 10px;
            border-radius: 20px;
            margin-top: 5px;
            display: inline-block;
        }

        /* Container do Tabuleiro */
        #game-container {
            max-width: 800px;
            margin: 0 auto;
            flex: 1;
            transition: filter 0.3s;
            width: 100%;
            padding: 0 10px 20px 10px;
        }

        /* Expande o container no modo pesadelo */
        #game-container.container-fluid-nightmare {
            max-width: 1400px;
        }

        #game-board {
            display: grid;
            gap: 10px;
            perspective: 1000px;
            margin: 0 auto;
            justify-content: center;
        }

        /* Cartas */
        .memory-card {
            background-color: transparent;
            aspect-ratio: 3/4;
            border: none;
            cursor: pointer;
            position: relative;
            width: 100%; 
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
            transform-style: preserve-3d;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        .memory-card:active .card-inner {
            transform: scale(0.97);
        }

        .memory-card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        /* Parte de tr√°s (vis√≠vel inicialmente) */
        .card-front {
            background: linear-gradient(135deg, var(--card-back-color), #00acc1);
            color: white;
            font-size: 2rem;
        }

        /* Parte da frente (com o emoji) */
        .card-back {
            background-color: var(--card-bg-front);
            transform: rotateY(180deg);
            border: 2px solid #eee;
            font-size: 2.5rem;
        }

        /* --- Estilos Espec√≠ficos para PESADELO (100 cartas) --- */
        .game-nightmare {
            gap: 4px !important;
        }

        .game-nightmare .memory-card {
            border-radius: 4px;
        }
        
        .game-nightmare .card-inner,
        .game-nightmare .card-front,
        .game-nightmare .card-back {
            border-radius: 5px;
        }

        .game-nightmare .card-front { font-size: 1rem; }
        .game-nightmare .card-back { 
            font-size: 1.5rem;
            border-width: 1px;
        }

        /* Responsividade Extrema para Pesadelo */
        @media (max-width: 768px) {
            .game-nightmare {
                grid-template-columns: repeat(5, 1fr) !important; 
            }
            .game-nightmare .card-back { font-size: 1.2rem; }
        }

        @media (min-width: 769px) {
            .game-nightmare {
                grid-template-columns: repeat(10, 1fr) !important;
            }
        }

        .memory-card.matched .card-inner .card-back {
            background-color: #d1e7dd;
            border-color: #badbcc;
            box-shadow: 0 0 10px #a3cfbb;
            animation: pulse 0.5s ease-in-out;
        }
        
        .memory-card.matched {
            cursor: default;
        }

        @keyframes pulse {
            0% { transform: rotateY(180deg) scale(1); }
            50% { transform: rotateY(180deg) scale(1.1); }
            100% { transform: rotateY(180deg) scale(1); }
        }

        /* Modais */
        .modal-custom-backdrop {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1050;
            backdrop-filter: blur(8px);
            transition: opacity 0.3s;
        }

        .modal-custom-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 95%;
            width: 500px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: slideUp 0.5s ease-out;
            border: 4px solid white;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-custom-content.start-screen-content {
            background: linear-gradient(to bottom right, #ffffff, #f0f8ff);
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Bot√µes de Dificuldade */
        .difficulty-btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-check:checked + .btn-outline-primary {
            background-color: #006064;
            border-color: #006064;
            color: white;
            box-shadow: 0 4px 10px rgba(0,96,100,0.3);
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- Tela Inicial (Sele√ß√£o de Dificuldade + Recordes) -->
    <div id="start-screen" class="modal-custom-backdrop">
        <div class="modal-custom-content start-screen-content">
            <h1 class="fw-bold text-primary mb-1" style="font-family: 'Poppins', sans-serif; font-weight: 800;">MEM√ìRIA</h1>
            <p class="text-muted mb-4">Escolha seu desafio</p>

            <div class="card border-0 bg-light mb-4 shadow-sm">
                <div class="card-body py-2">
                    <div class="row align-items-center">
                        <div class="col-12 mb-2 border-bottom pb-2">
                            <span class="text-uppercase text-secondary fw-bold" style="font-size: 0.7rem;">Recorde (<span id="record-label">M√©dio</span>)</span>
                        </div>
                        <div class="col-6 border-end">
                            <span class="d-block text-muted small">Tempo</span>
                            <span class="fs-5 fw-bold text-dark" id="best-time-display">--:--</span>
                        </div>
                        <div class="col-6">
                            <span class="d-block text-muted small">Movimentos</span>
                            <span class="fs-5 fw-bold text-dark" id="best-moves-display">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="difficulty-btn-group">
                <input type="radio" class="btn-check" name="difficulty" id="diff-easy" value="easy">
                <label class="btn btn-outline-primary py-2 fw-bold rounded-3" for="diff-easy">
                    üü¢ F√°cil
                    <small class="d-block fw-normal" style="font-size: 0.7rem">6 Pares</small>
                </label>

                <input type="radio" class="btn-check" name="difficulty" id="diff-medium" value="medium" checked>
                <label class="btn btn-outline-primary py-2 fw-bold rounded-3" for="diff-medium">
                    üîµ M√©dio
                    <small class="d-block fw-normal" style="font-size: 0.7rem">10 Pares</small>
                </label>

                <input type="radio" class="btn-check" name="difficulty" id="diff-hard" value="hard">
                <label class="btn btn-outline-primary py-2 fw-bold rounded-3" for="diff-hard">
                    üü† Dif√≠cil
                    <small class="d-block fw-normal" style="font-size: 0.7rem">15 Pares</small>
                </label>

                <input type="radio" class="btn-check" name="difficulty" id="diff-nightmare" value="nightmare">
                <label class="btn btn-outline-danger py-2 fw-bold rounded-3" for="diff-nightmare" style="grid-column: span 2; border-width: 2px;">
                    üòà PESADELO
                    <small class="d-block fw-normal" style="font-size: 0.7rem">50 Pares (100 Cartas!)</small>
                </label>
            </div>

            <button class="btn btn-primary btn-lg w-100 py-3 fw-bold rounded-pill shadow hover-effect" onclick="startGame()">
                JOGAR AGORA
            </button>
        </div>
    </div>

    <div class="container mt-2" id="game-container">
        
        <div class="header-painel d-flex justify-content-between align-items-center">
            <div class="stat-box text-start">
                <div class="stat-label">Movimentos</div>
                <div class="stat-value" id="moves-count">0</div>
            </div>
            
            <div class="text-center">
                <h5 class="m-0 d-none d-sm-block fw-bold text-secondary">MEM√ìRIA</h5>
                <span class="badge-difficulty" id="current-difficulty-badge">M√âDIO</span>
            </div>

            <div class="stat-box text-end">
                <div class="stat-label">Tempo</div>
                <div class="stat-value" id="timer">00:00</div>
            </div>

            <button id="reset-btn" class="btn btn-outline-info rounded-circle p-2 ms-3" title="Voltar ao Menu" onclick="showStartScreen()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-house-door-fill" viewBox="0 0 16 16">
                    <path d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5z"/>
                </svg>
            </button>
        </div>

        <div id="game-board">
            <!-- As cartas ser√£o geradas via JS -->
        </div>

    </div>

    <!-- Modal de Vit√≥ria -->
    <div id="victory-modal" class="modal-custom-backdrop hidden">
        <div class="modal-custom-content">
            <div class="mb-3 display-1">üèÜ</div>
            <h2 class="fw-bold mb-1">Parab√©ns!</h2>
            <p class="text-muted small mb-3">Dificuldade: <strong id="victory-difficulty">M√©dia</strong></p>
            
            <div class="row g-2 mb-4">
                <div class="col-6">
                    <div class="p-2 bg-light rounded">
                        <small class="d-block text-muted">Tempo</small>
                        <strong id="final-time" class="fs-5">00:00</strong>
                    </div>
                </div>
                <div class="col-6">
                    <div class="p-2 bg-light rounded">
                        <small class="d-block text-muted">Movimentos</small>
                        <strong id="final-moves" class="fs-5">0</strong>
                    </div>
                </div>
            </div>

            <div id="new-record-msg" class="alert alert-warning py-2 mb-3 hidden" role="alert">
                ‚ú® <strong>Novo Recorde!</strong> ‚ú®
            </div>

            <button class="btn btn-primary w-100 py-2 fw-bold shadow-sm" onclick="showStartScreen()">Menu Principal</button>
            <button class="btn btn-link text-muted mt-2" onclick="createBoard()">Jogar Novamente</button>
        </div>
    </div>

    <script>
        // --- Elementos do DOM ---
        const gameContainer = document.getElementById('game-container');
        const gameBoard = document.getElementById('game-board');
        const movesCountEl = document.getElementById('moves-count');
        const timerEl = document.getElementById('timer');
        const startScreen = document.getElementById('start-screen');
        const victoryModal = document.getElementById('victory-modal');
        const currentDiffBadge = document.getElementById('current-difficulty-badge');
        
        // Elementos de Recorde na Tela Inicial
        const bestTimeDisplay = document.getElementById('best-time-display');
        const bestMovesDisplay = document.getElementById('best-moves-display');
        const recordLabel = document.getElementById('record-label');
        const difficultyRadios = document.getElementsByName('difficulty');

        // Elementos de Vit√≥ria
        const finalTimeEl = document.getElementById('final-time');
        const finalMovesEl = document.getElementById('final-moves');
        const victoryDifficulty = document.getElementById('victory-difficulty');
        const newRecordMsg = document.getElementById('new-record-msg');

        // --- Configura√ß√µes do Jogo ---
        // Lista GIGANTE de emojis para suportar at√© 50 pares (100 cartas)
        const allSymbols = [
            'üçé', 'üçå', 'üçâ', 'üçá', 'üçì', 'üçí', 'ü•ù', 'üçç', 'ü•ë', 'üåΩ', 
            'ü•ï', 'ü•î', 'ü•¶', 'ü••', 'ü•ú', 'üçÑ', 'üçÖ', 'üçÜ', 'üçû', 'üßÄ',
            'üçñ', 'üçó', 'üçî', 'üçü', 'üçï', 'üå≠', 'üåÆ', 'üåØ', 'ü•ö', 'üçø',
            'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ',
            'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üêî', 'üêß', 'üê¶', 'üê§', 'ü¶Ü',
            '‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê', 'üèâ', 'üé±', 'üèì', 'üè∏',
            'üöó', 'üöï', 'üöô', 'üöå', 'üöì', 'üöë', 'üöí', 'üöê', 'üöö', 'üöõ',
            '‚åö', 'üì±', 'üíª', '‚å®Ô∏è', 'üñ•Ô∏è', 'üñ®Ô∏è', 'üñ±Ô∏è', 'üì∑', 'üìπ', 'üì∫'
        ];

        // Configura√ß√µes por dificuldade
        const difficultySettings = {
            easy: { 
                pairs: 6, // 12 cartas
                cols: 3, // Grid 3x4
                label: "F√°cil",
                class: "game-easy"
            },
            medium: { 
                pairs: 10, // 20 cartas
                cols: 4, // Grid 4x5
                label: "M√©dio",
                class: "game-medium"
            },
            hard: { 
                pairs: 15, // 30 cartas
                cols: 5, // Grid 5x6
                label: "Dif√≠cil",
                class: "game-hard"
            },
            nightmare: { 
                pairs: 50, // 100 cartas!!
                cols: 10, // Grid 10x10 (no desktop)
                label: "Pesadelo",
                class: "game-nightmare"
            }
        };

        // --- Estado do Jogo ---
        let currentDifficulty = 'medium';
        let cardsList = [];
        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let moves = 0;
        let matchedPairs = 0;
        let timerInterval = null;
        let seconds = 0;
        let gameStarted = false;

        // --- Gerenciamento de Recordes (LocalStorage) ---
        
        function updateRecordDisplay(difficulty) {
            const timeKey = `memoryBestTime_${difficulty}`;
            const movesKey = `memoryBestMoves_${difficulty}`;
            
            const bestTime = localStorage.getItem(timeKey);
            const bestMoves = localStorage.getItem(movesKey);
            
            recordLabel.textContent = difficultySettings[difficulty].label;

            if (bestTime) {
                bestTimeDisplay.textContent = formatTime(parseInt(bestTime));
            } else {
                bestTimeDisplay.textContent = "--:--";
            }

            if (bestMoves) {
                bestMovesDisplay.textContent = bestMoves;
            } else {
                bestMovesDisplay.textContent = "--";
            }
        }

        difficultyRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                updateRecordDisplay(e.target.value);
            });
        });

        function saveRecord(currentSeconds, currentMoves) {
            let isNewRecord = false;
            const timeKey = `memoryBestTime_${currentDifficulty}`;
            const movesKey = `memoryBestMoves_${currentDifficulty}`;
            
            const bestTime = localStorage.getItem(timeKey);
            if (!bestTime || currentSeconds < parseInt(bestTime)) {
                localStorage.setItem(timeKey, currentSeconds);
                isNewRecord = true;
            }

            const bestMoves = localStorage.getItem(movesKey);
            if (!bestMoves || currentMoves < parseInt(bestMoves)) {
                localStorage.setItem(movesKey, currentMoves);
                isNewRecord = true;
            }

            return isNewRecord;
        }

        // --- Fun√ß√µes Auxiliares ---

        function formatTime(secs) {
            const min = Math.floor(secs / 60);
            const s = secs % 60;
            return `${min.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            if (gameStarted) return;
            gameStarted = true;
            timerInterval = setInterval(() => {
                seconds++;
                timerEl.textContent = formatTime(seconds);
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            gameStarted = false;
        }

        function resetTimer() {
            stopTimer();
            seconds = 0;
            timerEl.textContent = "00:00";
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- Fluxo de Telas ---

        function showStartScreen() {
            stopTimer(); 
            const selectedDiff = document.querySelector('input[name="difficulty"]:checked').value;
            updateRecordDisplay(selectedDiff);

            victoryModal.classList.add('hidden');
            startScreen.classList.remove('hidden');
            gameContainer.style.filter = "blur(5px)";
        }

        function startGame() {
            const selectedRadio = document.querySelector('input[name="difficulty"]:checked');
            if (selectedRadio) {
                currentDifficulty = selectedRadio.value;
            }

            startScreen.classList.add('hidden');
            gameContainer.style.filter = "none";
            
            createBoard();
        }

        // --- L√≥gica Principal do Jogo ---

        function createBoard() {
            const settings = difficultySettings[currentDifficulty];
            
            // Configura√ß√µes Visuais
            gameBoard.innerHTML = '';
            gameBoard.className = ''; 
            gameBoard.classList.add(settings.class);
            
            // Configura colunas do Grid
            // Se for pesadelo, o CSS Media Query toma conta da responsividade (5 col mobile, 10 desktop)
            if (currentDifficulty !== 'nightmare') {
                 gameBoard.style.gridTemplateColumns = `repeat(${settings.cols}, 1fr)`;
                 gameContainer.classList.remove('container-fluid-nightmare');
            } else {
                 gameBoard.style.gridTemplateColumns = ''; // Deixa o CSS decidir
                 gameContainer.classList.add('container-fluid-nightmare'); // Expande largura
            }
            
            // Atualiza Badge
            currentDiffBadge.textContent = settings.label;

            // Reseta Estado
            moves = 0;
            matchedPairs = 0;
            movesCountEl.textContent = moves;
            hasFlippedCard = false;
            lockBoard = false;
            firstCard = null;
            secondCard = null;
            
            victoryModal.classList.add('hidden');
            resetTimer();

            // Prepara as cartas
            // Verifica se temos s√≠mbolos suficientes, sen√£o recicla
            let neededSymbols = settings.pairs;
            let gameSymbols = [];
            
            // Se precisarmos de mais s√≠mbolos do que temos na lista (caso extremo), repete a lista
            if (neededSymbols > allSymbols.length) {
                // Isso √© s√≥ seguran√ßa, nossa lista tem ~80 itens
                const repeats = Math.ceil(neededSymbols / allSymbols.length);
                let extendedList = [];
                for(let i=0; i<repeats; i++) extendedList = extendedList.concat(allSymbols);
                gameSymbols = extendedList.slice(0, neededSymbols);
            } else {
                gameSymbols = allSymbols.slice(0, neededSymbols);
            }

            // Duplica
            cardsList = [...gameSymbols, ...gameSymbols];
            // Embaralha
            shuffle(cardsList);

            cardsList.forEach(symbol => {
                const card = document.createElement('div');
                card.classList.add('memory-card');
                card.dataset.symbol = symbol;

                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-question-lg" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M4.475 5.458c-.284 0-.514-.237-.47-.517C4.28 3.24 5.576 2 7.825 2c2.25 0 3.767 1.36 3.767 3.215 0 1.344-.665 2.288-1.79 2.973-1.1.659-1.414 1.118-1.414 2.01v.03a.5.5 0 0 1-.5.5h-.77a.5.5 0 0 1-.5-.495l-.002-.279c0-1.13.407-1.71 1.627-2.457 1.096-.665 1.55-1.155 1.55-2.012 0-1.118-.948-1.664-2.193-1.664-1.336 0-1.996.75-2.113 1.636-.046.353-.356.561-.706.561z"/>
                                <path d="M7.594 10.82c-.63 0-1.144-.32-1.144-.826 0-.505.515-.826 1.144-.826.63 0 1.144.32 1.144.826 0 .505-.515.826-1.144.826z"/>
                            </svg>
                        </div>
                        <div class="card-back">${symbol}</div>
                    </div>
                `;

                card.addEventListener('click', flipCard);
                gameBoard.appendChild(card);
            });
        }

        function flipCard() {
            if (!gameStarted) startTimer();
            
            if (lockBoard || this === firstCard || this.classList.contains('matched')) return;

            this.classList.add('flipped');

            if (!hasFlippedCard) {
                hasFlippedCard = true;
                firstCard = this;
                return;
            }

            secondCard = this;
            moves++;
            movesCountEl.textContent = moves;
            checkForMatch();
        }

        function checkForMatch() {
            let isMatch = firstCard.dataset.symbol === secondCard.dataset.symbol;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            // FIX: Trava o tabuleiro imediatamente para evitar cliques r√°pidos em cartas que est√£o sendo processadas
            lockBoard = true; 
            
            setTimeout(() => {
                firstCard.classList.add('matched');
                secondCard.classList.add('matched');
                resetBoardState(); // FIX: Libera o tabuleiro s√≥ depois que as classes 'matched' foram aplicadas
            }, 200);

            matchedPairs++;
            
            const settings = difficultySettings[currentDifficulty];
            if (matchedPairs === settings.pairs) {
                stopTimer();
                setTimeout(showVictory, 600);
            }
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                firstCard.classList.remove('flipped');
                secondCard.classList.remove('flipped');
                resetBoardState();
            }, 1000);
        }

        function resetBoardState() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        function showVictory() {
            finalTimeEl.textContent = formatTime(seconds);
            finalMovesEl.textContent = moves;
            victoryDifficulty.textContent = difficultySettings[currentDifficulty].label;

            const isNewRecord = saveRecord(seconds, moves);
            
            if (isNewRecord) {
                newRecordMsg.classList.remove('hidden');
            } else {
                newRecordMsg.classList.add('hidden');
            }

            victoryModal.classList.remove('hidden');
        }

        // --- Inicializa√ß√£o ---
        updateRecordDisplay('medium'); 
        showStartScreen(); 

    </script>
</body>
</html>